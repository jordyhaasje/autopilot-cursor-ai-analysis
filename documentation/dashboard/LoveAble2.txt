ğŸ¯Â Complete Database Connecties Overzicht
ğŸ“‹ Aanmeld & Authenticatie Flow
Wanneer een gebruiker zich registreert gebeurt het volgende:
	â€¢	auth.usersÂ (Supabase Auth)Â - Hier wordt de basis user account aangemaakt
	â€¢	profilesÂ tabelÂ - Automatisch gekoppeld via trigger:
	â€¢	user_idÂ â†’ Verwijst naarÂ auth.users.id
	â€¢	emailÂ â†’ Email adres van registratie
	â€¢	roleÂ â†’ Standaard 'user' (kan 'admin' worden)
	â€¢	tenant_idÂ â†’ Wordt later ingevuld wanneer tenant wordt goedgekeurd
	â€¢	tenantsÂ tabelÂ - Na provider selectie (Gmail/Zoho):
	â€¢	bedrijfsnaamÂ â†’ Bedrijfsnaam uit registratie
	â€¢	gmail_emailÂ â†’ Email waar mee geregistreerd
	â€¢	gmail_password_encryptedÂ â†’ Base64 encoded email wachtwoord
	â€¢	shop_urlÂ â†’ Website URL
	â€¢	ai_persona_nameÂ â†’ Naam van AI assistent (standaard 'Eva')
	â€¢	sectorÂ â†’ Bedrijfssector (standaard 'fashion')
	â€¢	taalvoorkeurÂ â†’ Taal (NL/EN)
	â€¢	statusÂ â†’ 'pending_approval' (wacht op admin goedkeuring)
	â€¢	activeÂ â†’ Boolean voor actieve status
	â€¢	retouradresÂ â†’ Retouradres voor klanten
ğŸ”— Dashboard Data Koppelingen
Profile & Tenant Data (viaÂ useProfile()Â hook):
SELECT * FROM profiles WHERE user_id = auth.uid()
JOIN tenants ON tenants.tenant_id = profiles.tenant_id
Dit haalt op:
	â€¢	Alle bedrijfsinstellingen (maximaal_extra_compensatie, dagen_instellingen)
	â€¢	AI configuratie (persona_name, signature_html)
	â€¢	Werkflow instellingen (n8n_workflow_id, api_key)
ğŸ“Š Business Rules Systeem
master_business_rulesÂ - Template regels:
	â€¢	retourbeleid_fashionÂ - Fashion Retourbeleid
	â€¢	onderhandeling_logicaÂ - Compensatie Onderhandeling (+15%)
	â€¢	dreiging_detectieÂ - Dreiging & Escalatie
	â€¢	annulering_policyÂ - Annuleringsbeleid
	â€¢	adreswijziging_policyÂ - Adreswijziging
tenant_business_rulesÂ - Tenant-specifieke regels:
	â€¢	Gekoppeld viaÂ tenant_id
	â€¢	Elke tenant kan eigen configuratie hebben
	â€¢	rule_configÂ (JSON) bevat specifieke instellingen
	â€¢	html_templateÂ voor email responses
ğŸ’¬ Chat & Klantinteractie
chat_sessionsÂ - Live chat sessies:
	â€¢	tenant_idÂ â†’ Gekoppeld aan bedrijf
	â€¢	user_emailÂ â†’ Klant email
	â€¢	admin_idÂ â†’ Welke admin helpt
	â€¢	statusÂ â†’ open/closed
chat_messagesÂ - Chat berichten:
	â€¢	session_idÂ â†’ Verwijst naar chat_sessions
	â€¢	sender_typeÂ â†’ 'user' of 'admin'
	â€¢	messageÂ â†’ Bericht inhoud
conversation_threadsÂ - Klant gesprek geschiedenis:
	â€¢	tenant_idÂ â†’ Bedrijf koppeling
	â€¢	customer_emailÂ â†’ Klant identificatie
	â€¢	escalation_levelÂ â†’ Escalatie niveau (0-3)
	â€¢	customer_moodÂ â†’ 'neutral', 'frustrated', etc.
	â€¢	vip_statusÂ â†’ VIP klant boolean
ğŸ“ˆ Klant Interacties & Analytics
customer_interactionsÂ - Alle klant interacties:
	â€¢	tenant_idÂ â†’ Bedrijf koppeling
	â€¢	thread_idÂ â†’ Verwijst naar conversation_threads
	â€¢	customer_emailÂ â†’ Klant identificatie
	â€¢	message_bodyÂ â†’ Originele klant email
	â€¢	ai_responseÂ â†’ AI gegenereerde response
	â€¢	compensatie_percentageÂ â†’ Toegekende compensatie %
	â€¢	dreiging_detectedÂ â†’ Boolean voor dreiging detectie
	â€¢	annulering_aangevraagdÂ â†’ Boolean voor annulering
	â€¢	ladder_stapÂ â†’ Compensatie ladder niveau
ğŸ”” Notificaties & Alerts
notificationsÂ - Systeem meldingen:
	â€¢	tenant_idÂ â†’ Bedrijf koppeling
	â€¢	thread_idÂ â†’ Gekoppeld aan gesprek
	â€¢	typeÂ â†’ 'escalation', 'threat', 'high_compensation'
	â€¢	priorityÂ â†’ 'high', 'medium', 'low'
	â€¢	action_requiredÂ â†’ Boolean voor actie vereist
âš™ï¸ Email Filters & Instellingen
email_filtersÂ - Email filtering:
	â€¢	tenant_idÂ â†’ Bedrijf koppeling
	â€¢	filter_typeÂ â†’ 'allow', 'block', 'spam'
	â€¢	email_addressÂ â†’ Specifiek email adres
	â€¢	domainÂ â†’ Domein filtering
	â€¢	is_regexÂ â†’ Boolean voor regex patronen
ğŸ“‹ RLS (Row Level Security) Beveiliging
Alle data is beveiligd per tenant:
	â€¢	Gebruikers zien alleen hun eigen tenant data
	â€¢	Admins kunnen alle data zien
	â€¢	Functies zoalsÂ get_user_tenant_id()Â zorgen voor isolatie
	â€¢	Chat en interacties zijn volledig gescheiden per bedrijf
ğŸ¯ Key Database Functies
	â€¢	get_user_tenant_id()Â - Haalt tenant_id op van ingelogde user
	â€¢	get_current_user_role()Â - Controleert of user admin is
	â€¢	approve_tenant_v2()Â - Keurt tenants goed (alleen admins)
	â€¢	handle_new_user()Â - Maakt automatisch profile aan bij registratie
	â€¢	link_profile_to_tenant()Â - Koppelt profile aan tenant na goedkeuring
Dit systeem zorgt ervoor dat elke tenant volledig geÃ¯soleerd is, alle klantinteracties worden bijgehouden, en het dashboard real-time data toont gebaseerd op de tenant van de ingelogde gebruiker.

